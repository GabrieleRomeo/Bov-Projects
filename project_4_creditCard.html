<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>
    Modern Developer :: HTML & CSS Project Assignment - Credit Card
  </title>
  <meta name="description" 
        content="Modern Developer :: HTML & CSS Project Assignment 
                 - Credit Card">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="stylesheet" 
        href="https://fonts.googleapis.com/css?family=Raleway:400,300italic">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/showcase.css">
  <link rel="stylesheet" href="css/topBar.css">
  <link rel="stylesheet" href="css/project_4_creditCard.css">  
</head>
<body>

  <header class="topbar" role="banner">
    <nav class="topbar__nav" role="navigation">
      <ul class="topbar__nav__list">
        <li class="nav__list__item nav__list__item--home">
          <a class="nav__link" href="index.html" title="Home Page">
            &#8962; Home
          </a>
        </li>        
        <li class="nav__list__item">
          <a  class="nav__link" 
              href="project_4.html" 
              title="Next Project">
            Next Project &#8680;
          </a>
        </li>
      </ul>
      <p class="topbar__nav__title">4: Credit / Debit Card</p>
    </nav>
  </header>
    
    <!-- PROJECT CONTENT -->
    
  <div id="super-wrapper">
    <div id="card-wrapper">
        <p>secure payment</p>
        <header id="head-section">
            <h1>enter payment information</h1>
            <picture>
              <img class="header__img" src="images/lock_big.png">
            </picture>
        </header>
        <section id="card-section">
          <div id="list-card-wrapper">
            <p>Please select a credit card type</p>
            <ul id="list-card">
                <li><a href="#mastercard" class="mastercard active" title="Mastercard"></a></li>
                <li class="active"><a href="#visa" class="visa" title="Visa"></a></li>
                <li><a href="#maestro" class="maestro" title="Maestro"></a></li>
                <li><a href="#cirrus" class="cirrus" title="Cirrus"></a></li>
            </ul>
          </div>
        <form id="cardForm" name="cardForm" action="#" method="#">
          <div id="card-info">
            <ul class="form-list">
              <li>
                <label for="cardNumber">Card Number</label>
                <input id="cardNumber" 
                       type="text" 
                       name="cardNumber"  
                       maxlength="19"
                       required>
              </li>
              <li>
                <label for="expirationMonth">Card expiration</label>
                <select name="expirationMonth" id="expirationMonth" required>
                    <option value="">Month</option>
                    <option value="1">01 - January</option>
                    <option value="2">02 - February</option>
                    <option value="3">03 - March</option>
                    <option value="4">04 - April</option>
                    <option value="5">05 - May</option>
                    <option value="6">06 - June</option>
                    <option value="7">07 - July</option>
                    <option value="8">08 - August</option>
                    <option value="9">09 - September</option>
                    <option value="10">10 - October</option>
                    <option value="11">11 - November</option>
                    <option value="12">12 - December</option>
                </select>
                <select name="expirationYear" id="expirationYear" required>
                    <option value="">Year</option>
                    <option value="0">2016</option>
                    <option value="1">2017</option>
                    <option value="2">2018</option>
                    <option value="3">2019</option>
                    <option value="4">2020</option>
                    <option value="5">2021</option>
                    <option value="6">2022</option>
                    <option value="7">2023</option>
                    <option value="8">2024</option>
                    <option value="9">2025</option>
                    <option value="10">2026</option>
                    <option value="11">2027</option>
                    <option value="12">2028</option>
                    <option value="13">2029</option>
                    <option value="14">2030</option>
                </select>                               
              </li>
              <li>
                <label for="fullName">Full Name</label>
                <input name="fullName" id="fullName" type="text" required>
              </li>
            </ul>
          </div>
          <div id="security-info">
            <p></p>
            <div id="right">
              <ul class="form-list">
                <li>
                  <label for="csvNumber">CVC / CCV</label>
                  <input id="csvNumber"
                         name="csvNumber"
                         type="text" 
                         maxlength="3"
                         required>   
                  <span>The last 3 digits on back of the card</span>
                </li>
              </ul>
            </div>
          </div>
          <input type="submit" class="submitButton" value="Submit Payment">
        </form> 
        </section>
    </div>
  </div>

  <script src="js/validator.js"></script>
  <script>
      var valid = Validators;
      var doc   = document;
      var form  = doc.getElementById('cardForm');

      var inputs = {
          cardNumber:   valid.getNode(doc.getElementById('cardNumber')),
          expM:         valid.getNode(doc.getElementById('expirationMonth'),
                                                         'expirationMonth'),
          expY:         valid.getNode(doc.getElementById('expirationYear'),
                                                         'expirationYear'),
          fullName:     valid.getNode(doc.getElementById('fullName')),
          csv:          valid.getNode(doc.getElementById('csvNumber'),
                                                         'csvNumber')
      }

      /*
       * For each input, defines a particular Validator function that must 
       * be satisfied to proceed further. 
       */

      inputs.cardNumber.setConstraint('The Card Number must be a non-empty ' +
                                   'string of sixteen alphanumeric characters');
      inputs.cardNumber.setValidator(function(elem){

          var value = elem.node.value;

          try { 
              if (!valid.isCreditCard(value)) {
                    elem.node.setCustomValidity(elem.constrValue);
              } else {
                    elem.resetCustomValidity();
              }
          } catch (err) {
            console.log(err);
                  elem.node.setCustomValidity(elem.constrValue);
          }

      });

      inputs.expM.setConstraint('Please select the Expiration Month');
      inputs.expM.setValidator(function(elem) {

          var node = elem.node;
          
          if (valid.isEmpty(node.options[node.selectedIndex].value)) {
                node.setCustomValidity(elem.constrValue);
          } else {
                elem.resetCustomValidity();
          }

      });

      inputs.expY.setConstraint('Please select the Expiration Year');
      inputs.expY.setValidator(function(elem) {

          var node = elem.node;
          
          if (valid.isEmpty(node.options[node.selectedIndex].value)) {
                node.setCustomValidity(elem.constrValue);
          } else {
                elem.resetCustomValidity();
          }

      });

      inputs.fullName.setConstraint('The Full Name must be a non-empty ' +
                                   'string of at least two words');
      inputs.fullName.setValidator(function(elem){

          var value = elem.node.value;

          try { 
              if (valid.lessWordsThan(value, 1)) {
                    elem.node.setCustomValidity(elem.constrValue);
              } else {
                    elem.resetCustomValidity();
              }
          } catch (err) {
                  elem.node.setCustomValidity(elem.constrValue);
          }

      });

      inputs.csv.setConstraint('Please provide a valid CVC/CCV number \n' +
                               'The last 3 digits on back of the card');
      inputs.csv.setValidator(function(elem){

          var value = elem.node.value;

          try { 
              if (valid.isLength(value, 2) || isNaN(value)) {
                    elem.node.setCustomValidity(elem.constrValue);
              } else {
                    elem.resetCustomValidity();
              }
          } catch (err) {
                  elem.node.setCustomValidity(elem.constrValue);
          }

      });

      /* Sets an initial custom validity for every input 
       * All the indicated inputs are not valid by default
       */

      for (var input in inputs) {
        if (inputs.hasOwnProperty(input)) {
          if (inputs[input].constr.isRequired) {
            inputs[input].node.setCustomValidity(
                                              inputs[input].constr.constrValue);
          }
          
          // Using a closure, it defines a custom event listener for every
          // single inputs object
          (function(input) {
            input.node.addEventListener('change', function (event) {
                var constr  = input.constr;
                constr.setInvalidClass();
                constr.check();
            })
          })(inputs[input]);
        }
      }


      form.addEventListener('submit', function (event) {

      // Check the inputs validity. If at least one input is invalid, stop
      // the event propagation
      for (var input in inputs) {
          if (inputs.hasOwnProperty(input)) {
              if (!inputs[input].node.validity.valid) {
                  event.preventDefault();
              }
          }
      }

      }, false);
  </script>
</body>
</html>