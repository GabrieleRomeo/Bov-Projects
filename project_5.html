<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>
    Modern Developer :: HTML & CSS Project Assignment - Calculator
  </title>
  <meta name="description" 
        content="Modern Developer :: HTML & CSS Project Assignment 
                 - Calculator">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="stylesheet" 
        href="https://fonts.googleapis.com/css?family=Raleway:400,300italic">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/showcase.css">
  <link rel="stylesheet" href="css/topBar.css">
  <link rel="stylesheet" href="css/calculator.css">
</head>
<body>

  <header class="topbar" role="banner">
    <nav class="topbar__nav" role="navigation">
      <ul class="topbar__nav__list">
        <li class="nav__list__item nav__list__item--home">
          <a class="nav__link" href="index.html" title="Home Page">
            &#8962; Home
          </a>
        </li>        
        <li class="nav__list__item">
          <a  class="nav__link" 
              href="project_6.html" 
              title="Next Project">
            Next Project &#8680;
          </a>
        </li>
      </ul>
      <p class="topbar__nav__title">5: The Calculator</p>
    </nav>
  </header>
    
    <!-- PROJECT CONTENT -->
  <div id="calc-wrapper">
      <input id="result" name="result" type="text" disabled>
      <div id="calc-controls">
      <section id="top-controls">
        <input  class="button clear-controls"
                id="del"
                name="del"
                type="button"
                value="DEL">
        <input  class="button clear-controls"
                id="clear"
                name="clear"
                type="button"
                value="CLEAR">
      </section>
      <section id="numbers">
        <input  class="button" 
                id="7"
                name="7"
                type="button"
                value="7"> 
        <input  class="button" 
                id="8"
                name="8"
                type="button"
                value="8"> 
        <input  class="button" 
                id="9"
                name="9"
                type="button"
                value="9">
        <input  class="button" 
                id="4"
                name="4"
                type="button"
                value="4">
        <input  class="button" 
                id="5"
                name="5"
                type="button"
                value="5">
        <input  class="button" 
                id="6"
                name="6"
                type="button"
                value="6">
        <input  class="button" 
                id="1"
                name="1"
                type="button"
                value="1">
        <input  class="button" 
                id="2"
                name="2"
                type="button"
                value="2">
        <input  class="button" 
                id="3"
                name="3"
                type="button"
                value="3">
        <input  class="button double"
                id="0"
                name="0"
                type="button"
                value="0">
        <input  class="button double"
                id="comma"
                name="comma"
                type="button"
                value="&#44;">
        <input  class="button equal hover-controls"
                id="equal"
                name="equal"
                type="button"
                value="=">
      </section>
      <section id="controls">
        <input  class="button oper-controls hover-controls"
                id="add"
                name="add" 
                type="button"
                value="&#43;">
        <input  class="button oper-controls hover-controls"
                id="sub" 
                name="sub" 
                type="button" 
                value="&#45;">
        <input  class="button oper-controls hover-controls"
                id="div"
                name="div"
                type="button" 
                value="&#247;">
        <input  class="button oper-controls hover-controls"
                id="mult"
                name="mult"
                type="button"
                value="&#42;">
      </section>
      </div>
    </div>

<script>
  var resultInput = document.getElementById('result');
  var result = '';
  var numbersLayer = document.getElementById('numbers');
  var controlsLayer = document.getElementById('controls');
  var numberButtons = numbersLayer.childNodes;
  var controlButtons = controlsLayer.childNodes;
  var del = document.getElementById('del');
  var clr = document.getElementById('clear');
  var eql = document.getElementById('equal');
  var com = document.getElementById('comma');


  del.addEventListener('click', function(event) {
      updateResult('');
  })

  clr.addEventListener('click', function(event) {
      updateResult(result.substr(0, result.length - 1), "clear");
  })

  eql.addEventListener('click', function(event) {

      var partial;

      if (isLastCharNum()) {
          partial = (function() { return eval(result).toString() ; })();
          updateResult(partial, "=");
      }

  })

  com.addEventListener('click', function(event) {

      /* When the current result is already a decimal or the result
       * contains only 0, skip
       */
      if (isDecimal(result) || result.split(0).join(' ').trim() === '') {
        return;
      } 

      result += '.';
      resultInput.value = result;

  })

  // Numbers 0 - 9
  Object.keys(numberButtons).map(function(item) {

      if (!isNaN(numberButtons[item].id)) {
        numberButtons[item].addEventListener('click', function (event) {
            updateResult(this.value);
        })
      }
  })

  // Controls + - / *
  Object.keys(controlButtons).map(function(item) {    
      controlButtons[item].addEventListener('click', function (event) {

        /*
         * When last char is not a number, skip
         */
        if (!isLastCharNum()) {
            return;
        }

        updateResult(this.value.replace('รท','/'));
      })
  })

  function isDecimal(value) {

      if (!value) return true;

      var len = (value.length - 1) || 0;
      var partial = '';

      while (len > 0 && !(isNaN(value.charAt(len)) && value.charAt(len) !== '.')) {
          partial = partial + value.charAt(len);
          len--;
      };

     return (partial.indexOf('.') > -1);
  }

  function isLastCharNum() {
    return result.length > 0 ? !isNaN(result.charAt(result.length - 1)) : false;
  } 

  function getLastChar() {
    return result.charAt(result.length - 1);
  }

  function updateResult(value, opt) {

      if (!value) {
          result = '';
      }

      switch(opt) {
        case '=':
        case 'clear':
          result = (value === "Infinity") ? 'Division by 0' : value;
        break;

        default:
          result += value;
      }

      resultInput.value = result;

      if (result === 'Division by 0') result = '';
  }

</script>  
  
</body>
</html>