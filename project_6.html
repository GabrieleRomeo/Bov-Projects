<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>
    Modern Developer :: HTML & CSS Project Assignment - Product Listing
  </title>
  <meta name="description" 
        content="Modern Developer :: HTML & CSS Project Assignment 
                 - Product Listing">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="stylesheet" 
        href="https://fonts.googleapis.com/css?family=Raleway:400,300italic">
<link   rel="stylesheet" 
        href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,900">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/showcase.css">
  <link rel="stylesheet" href="css/topBar.css">
  <link rel="stylesheet" href="css/product.css">  
</head>
<body>

  <header class="topbar" role="banner">
    <nav class="topbar__nav" role="navigation">
      <ul class="topbar__nav__list">
        <li class="nav__list__item nav__list__item--home">
          <a class="nav__link" href="index.html" title="Home Page">
            &#8962; Home
          </a>
        </li>        
        <li class="nav__list__item">
          <a  class="nav__link" 
              href="project_2.html" 
              title="Next Project">
            Next Project &#8680;
          </a>
        </li>
      </ul>
      <p class="topbar__nav__title">6: Products List</p>
    </nav>
  </header>

    <!-- PROJECT CONTENT -->
  <article id="wrapper">
    <section id="products">
      <header>
        <div class="ribbon"><span>Fashion</span></div>
        <h1>Products List</h1>
      </header>
      <div id="products-wrapper">
          <div class="section">
            <a name="Product-1"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $10.00
                <div class="addToCart">
                  <span data-product-name="Product-1"
                        data-product-price="10"                         
                        data-product-type="1">
                      Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 1
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section">
            <a name="Product-2"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $8.00
                <div class="addToCart">
                  <span data-product-name="Product-2"
                        data-product-price="8"                        
                        data-product-type="1">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 2
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section rightMostSection">
            <a name="Product-3"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $135.00
                <div class="addToCart">
                  <span data-product-name="Product-3"
                        data-product-price="135"                         
                        data-product-type="1">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 3
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.ÃŒ
                </p>
              </div>
            </div>
          </div>
          <div class="section">
            <a name="Product-4"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $1.00
                <div class="addToCart">
                  <span data-product-name="Product-4"
                        data-product-price="1">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 4
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>            
            </div>
          </div>
          <div class="section">
            <a name="Product-5"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $10.00
                <div class="addToCart">
                  <span data-product-name="Product-5"
                        data-product-price="10">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 5
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section rightMostSection">
            <a name="Product-6"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $20.00
                <div class="addToCart">
                  <span data-product-name="Product-6"
                        data-product-price="20">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 6
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section">
            <a name="Product-7"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $310.00
                <div class="addToCart">
                  <span data-product-name="Product-7"
                        data-product-price="310">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 7
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section">
            <a name="Product-8"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $130.00
                <div class="addToCart">
                  <span data-product-name="Product-8"
                        data-product-price="130">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 8
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section rightMostSection">
            <a name="Product-9"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $5.00
                <div class="addToCart">
                  <span data-product-name="Product-9"
                        data-product-price="5">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 9
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section">
            <a name="Product-10"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $101.00
                <div class="addToCart">
                  <span data-product-price="101"
                        data-product-name="Product-10">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 10
                <span class="product-discount">10% off</span>
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section">
            <a name="Product-11"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer">
              <div class="price">
                Price: $45.00
                <div class="addToCart">
                  <span data-product-name="Product-11"
                        data-product-price="45">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 11
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
          <div class="section">
            <a name="Product-12"></a>
            <span class="thumb">
              <img src="images/278x278.png">
            </span>
            <div class="sectionContainer rightMostSection">
              <div class="price">
                Price: $10.00
                <div class="addToCart">
                  <span data-product-name="Product-12"
                        data-product-price="10">
                    Add to Cart
                  </span>
                </div>
              </div>
              <div class="title">
                Product 12
              </div>
              <div class="product-description">
                <p class="product-description__paragraph">
                Lorem ipsum dolor sit amet, consectetuer adipiscing elit. 
                Aenean commodo ligula eget dolor. Aenean massa.
                </p>
              </div>
            </div>
          </div>
      </div>
    </section>
    <!-- Cart Section -->
    <section id="cart">
      <header>
        <h1 class="cartTitle">Cart details</h1>
      </header>
      <div id="cart-wrapper">
        <div class="cartSteps">
          <a class="current">Step 1</a>
          <a>Step 2</a>
          <a>Step 3</a>
          <a>Step 4</a>
        </div>
        <div id="cart-details-table">
          <table id="cart-table" class="table">
          <tbody>
          </tbody>
          </table>
        </div>
        <div id="coupon">
        Use Coupon Code
          <input class="table__input"
                 id="couponCode" 
                 name="couponCode"
                 type="text">
          <span class="input-group-btn">
            <input type="button" value="Apply Coupon" class="btn">
          </span>
        </div>
        <div id="total-cart-wrapper">
          <table class="table table-border">          
          <tbody>
          <tr>
            <td class="text-right">Sub-total:</td>
            <td class="text-left"><span id="cartSubTot"></span></td>
          </tr>
          <!--
          <tr>
            <td class="text-right">Coupon(-5%):</td>
            <td class="text-left">$7.25</td>
          </tr>
          <tr>
            <td class="text-right">VAT(12%):</td>
            <td class="text-left">$16,53</td>  
          </tr>
          -->
          <tr>
            <td class="text-right">Total:</td>
            <td class="text-left"><span id="CartTotal"></span></td>          
          </tr>
          </tbody>
          </table>
        </div>
        <div id="cart-buttons">
          <span class="input-group-btn">
            <input class="btnM keepShp"
                   type="button" 
                   value="Keep Shopping" >
          </span>
          <span class="input-group-btn">
            <input class="btnM kckOut"
                   type="button"
                   value="Checkout" >
          </span>
        </div>
      </div>
    </section>
  </article>

<script src="js/validator.js"></script>
<script src="js/utilities.js"></script>
<script>

  var addButtons = document.getElementsByClassName('addToCart'),
      cart       = document.getElementById('cart'),
      cartTable  = document.getElementById('cart-table'),
      cartSubTot = document.getElementById('cartSubTot'),
      cartTotal  = document.getElementById('cartTotal'),
      len        = addButtons.length;

  var CartDB = {
    currency: '\u0024',
    promoCodes : {
      code: { 'bigsale': 5},
      codeTypes: {'1': 15, '2': 8},
      products: { 'product-10': 10}
    },
    products: {},
    addProd: function(product) {

        if (product && product.name && !this.products[product.name]) {
            this.products[product.name] = copy(product, {});
        } else if (this.products[product.name]) {
          this.products[product.name]['quantity'] += 1;
        }

        return this.products[product.name];
    },
    updateProd: function(product) {

        if (!product && !product.name && !product.quantity && 
            !this.products[product.name]) {
            return false;
        } 

        this.products[product.name]['quantity'] = parseInt(product.quantity);

        return this.products[product.name];
    },
    remProd: function(product) {
        if (product && product.name && this.products[product.name]) {
            delete this.products[product.name];
            return true;
        }
        return false;
    },
    getQuantity: function(productName) {

        var total = 0;

        if (productName && this.products[productName]['quantity']) {
            return this.products[productName]['quantity'];
        }

        for (var p in this.products) {
          if (this.products.hasOwnProperty(p) && this.products[p]['quantity']) {
              total += this.products[p]['quantity'];
          }
        }

        return total;
    },
    getProductsList: function() {
      return this.products;
    },
    getPromoCode: function(code) {
      return this.promoCodes[code] || void 0;
    },
    getDiscount: function(product) {

      var name = product.name;
      var type = product.type;

      if (!name) return void 0;

      name = name.toLowerCase();

      return this.promoCodes.products[name] || void 0;
    }
  };

    while(len--) {
        addButtons[len].addEventListener('click', function(event) {
            addProduct(this.firstChild.nextSibling);
        })
    }

    var addProduct = function(product) {

        var name      = product.getAttribute("data-product-name");
        var price     = product.getAttribute("data-product-price");
        var type      = product.getAttribute("data-product-type");
        var quantity  = product.quantity || 1;
        var newProd;

        price = parseFloat(price).toFixed(2);

        newProd = CartDB.addProd({
            name:       name,
            unitPrice:  price,
            type:       type,
            quantity:   quantity
        });

        if (newProd.quantity === 1) {
          addCartRow(newProd);
        } else {
          updateCartRow(newProd);
        }
       
        toggleCart();

    }

    var updateProduct = function(product) {

        var name      = product.name,
            quantity  = product.quantity || 1,
            update    = product.update || false;

        var updatedProd;

        updatedProd = CartDB.updateProd({
            name:       name,
            quantity:   quantity
        });

        if (!updatedProd) throw "Unable to update this product";

        updateCartRow(updatedProd);

        toggleCart();
    }

    var removeProduct = function(product) {

        if (!CartDB.remProd(product)) throw "Unable to remove this product";       
    }

    var updateCartRow = function(product) {

      var input   = document.getElementById('input-' + product.name);
      var partial = document.getElementById('partial-' + product.name);

      input.value = product.quantity;
      partial.innerHTML = getCurrency(calculateProdPrice(product));
    }

    var removeCartRow = function(row) {

        var sep = row.previousSibling;
        
        cartTable.deleteRow(row.rowIndex); 
        cartTable.deleteRow(sep.rowIndex); // Delete the separator row

        toggleCart();
    }

    // Utility functions

    function toggleCart() {

        var quantity = CartDB.getQuantity();
        var display = (window.getComputedStyle(cart, null).display);

        if (quantity === 0) {
            cart.style.display = 'none';
        } else if (quantity === 1) {
            cart.style.display = 'block';
        }
    }

    function createElem(obj) {

      var elem = document.createElement(obj.tag);
      var text;

      for (var attr in obj) {
          if (obj.hasOwnProperty(attr)) {
              if (attr === 'text') {
                  text = document.createTextNode(obj[attr]);
                  elem.appendChild(text);
              } else if (attr !== 'tag') {
                  elem.setAttribute(attr, obj[attr]);
              }              
          }
          
      }

      return elem;
    }

    var calculateProdPrice = function(product) {

      var unitPrice = product.unitPrice,
          quantity  = product.quantity,
          discount  = CartDB.getDiscount(product) || 0;

      var subTotal = unitPrice * quantity;

      return subTotal - ((discount / 100) * subTotal);
    }

    var calculateProdDiscount = function(product) {

      var unitPrice = product.unitPrice,
          discount  = CartDB.getDiscount(product) || 0;

      return unitPrice - ((discount / 100) * unitPrice);
    }

    function addCartRow(product) {

        var discount      = CartDB.getDiscount(product),
            unitPrice     = getCurrency(product.unitPrice),
            unitPriceDis  = getCurrency(calculateProdDiscount(product)),
            finalPrice    = getCurrency(calculateProdPrice(product)),
            partial;

        var tr   = createElem({ tag: 'TR' }),
            tr2  = createElem({ tag: 'TR' });

        var td    = createElem({ tag: 'TD', class: 'table__td text-center' }),
            td2   = createElem({ tag: 'TD', class: 'table__td text-left' }),
            td4   = createElem({ tag: 'TD', class: 'table__td text-left' }),
            td3   = createElem({ tag: 'TD', class: 'table__td text-left',
                                 text: 'Unit price: ' }),
            td5   = createElem({ tag: 'TD', class: 'table__td text-left' }),
            td6   = createElem({ tag: 'TD', class: 'table__td text-right' }),
            tdDisc  = createElem({ tag: 'TD', class: 'table__td text-left' }),
            tdSepa  = createElem({ tag: 'TD', class: 'table__td--separator',
                                   colspan: '7'
                                });

        var a = createElem({ 
          tag: 'A',
          src: '#'
        });

        var img  = createElem({ 
          tag: 'img', 
          class: 'table__img-thumbnail',
          src: 'images/64x64.png',
          alt: 'Product Image',
          title: 'Product Image' 
        });

        var aProd = createElem({ 
          tag: 'A', 
          href: '#' + product.name,
          text: Utilities.replaceAll(product.name, '-', ' ')
        });

        var inputTxt = createElem({ 
          tag: 'input', 
          class: 'table__input table__input--text',
          id: 'input-' + Utilities.replaceAll(product.name, ' ', '-'),
          name: 'input-' + Utilities.replaceAll(product.name, ' ', '-'),
          type: 'text',
          value: '1'
        });

        var spn = createElem({
              tag: 'SPAN', 
              class: 'input-group-btn'
          }),
          spnPrice = createElem({
              tag: 'SPAN',
              class: (discount) ? 'cart-product-discount ' + 
                                  ' cart-product-discount--price' 
                                : '',
              text: unitPrice
          }),
          spnPriceDiscount = createElem({
              tag: 'SPAN',
              text: ' ' + unitPriceDis
          }),
          spnDiscount = createElem({
              tag: 'SPAN', 
              class: 'cart-product-discount',
              text: discount + '% off'
          }),
          spnPartial = createElem({
              tag: 'SPAN', 
              id: 'partial-'+ Utilities.replaceAll(product.name, ' ', '-'),
              name: 'partial-'+ Utilities.replaceAll(product.name, ' ', '-'),
              text:  finalPrice
          });

        var removeButton = createElem({ 
            tag: 'input', 
            class: 'btn btn-red',
            id: 'remove-' + Utilities.replaceAll(product.name, ' ', '-'),
            type: 'button',
            value: 'Remove'
        });


        a.appendChild(img)
        td.appendChild(a);
        td2.appendChild(aProd);
        td3.appendChild(spnPrice);
        td4.appendChild(inputTxt);
        spn.appendChild(removeButton);
        td5.appendChild(spn);
        td6.appendChild(spnPartial);

        if (discount) {
          td3.appendChild(spnPriceDiscount);
          tdDisc.appendChild(spnDiscount);
        }

        tr2.appendChild(td); 
        tr2.appendChild(td2); 
        tr2.appendChild(td3); 
        tr2.appendChild(tdDisc);
        tr2.appendChild(td4); 
        tr2.appendChild(td5); 
        tr2.appendChild(td6);  

        tr.appendChild(tdSepa);

        cartTable.appendChild(tr);
        cartTable.appendChild(tr2);


        removeButton.addEventListener('click', function(event) {
            removeProduct(product);
            removeCartRow(this.parentNode.parentNode.parentNode);
        });

        inputTxt.addEventListener('change', function(event) {

            var id    = this.getAttribute('id'),
                value = this.value,
                name  = Utilities.replaceAll(id,'input-','');


            if (!Utilities.isInt(value) || 
                !Validators.isBetween(value, '0', 10)) {
                // restore the input's value 
                this.value = product.quantity;
            } else if (value === '0') {
                              //console.log(id + ' ' + product.name + ' ' + this);
                removeProduct(product);
                removeCartRow(this.parentNode.parentNode);
                return;
            }


            product.quantity = this.value;

            updateProduct(product); 
        
        });
    }



    var getCurrency = function(value) {

        var curr = CartDB.currency;

        return curr + currency(value, '.');
    }

    var currency = function(amount, separator) {
        var amnt    = amount.toString();
        var len     = amnt.length;
        var decimal = "";

        var remainder,
            partial;

        if (amnt.indexOf(".") !== -1) {
            decimal = amnt.substr(amnt.indexOf("."), 3);
            amnt    = amnt.substr(0, amnt.indexOf("."));
            len    -= 3; // remove decimal part from total length
        }

        if (len < 4) {
            return amnt;
        } else {
            remainder = amnt.substr(0, len - 3);
            partial   = amnt.substr(len - 3, 3);

            return currency(remainder, separator) + separator + partial + decimal;
        }
    }

    function copy(first, second) {
      for (var p in first) {
        if (first.hasOwnProperty(p)) {
            second[p] = first[p];
        }
      }
      return second;
    }

</script>


</body>
</html>